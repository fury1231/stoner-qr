# å°‹å¯¶æ´»å‹•ç³»çµ±

ä¸€å¥—è¼•é‡ç´šçš„ç¶²é æ‡‰ç”¨ç³»çµ±ï¼Œå°ˆç‚ºç·šä¸‹å¯¦é«”åº—é¢çš„å°‹å¯¶æ´»å‹•è¨­è¨ˆã€‚é¡§å®¢æƒæ QR Code å®Œæˆè¸©é»ï¼Œåº—å“¡å¯åœ¨å¾Œå°æ ¸å°ä¸¦å…Œæ›æŠ½çè³‡æ ¼ã€‚

## åŠŸèƒ½ç‰¹è‰²

- ğŸ¯ **é¡§å®¢ç«¯è¸©é»ç¶²é **: æƒæ QR Codeï¼Œè¼¸å…¥é›»å­éƒµä»¶å®Œæˆè¸©é»
- ğŸ‘¨â€ğŸ’¼ **åº—å“¡ç®¡ç†å¾Œå°**: æŸ¥è©¢é¡§å®¢è³‡æ ¼ä¸¦é€²è¡Œæ ¸éŠ·ç®¡ç†
- ğŸ”’ **å®‰å…¨é˜²è­·**: é˜²æ­¢é‡è¤‡é ˜å–ã€åŸºæœ¬èº«ä»½é©—è­‰
- ğŸ“± **éŸ¿æ‡‰å¼è¨­è¨ˆ**: é©é…æ‰‹æ©Ÿå’Œæ¡Œé¢è£ç½®
- ğŸš€ **è¼•é‡é«˜æ•ˆ**: ä½¿ç”¨ SQLite è³‡æ–™åº«ï¼Œéƒ¨ç½²ç°¡å–®

## ç³»çµ±éœ€æ±‚

- Node.js 14.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- npm æˆ– yarn åŒ…ç®¡ç†å™¨

## å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
npm install
```

### 2. åˆå§‹åŒ–è³‡æ–™åº«

```bash
npm run init-db
```

åŸ·è¡Œå¾Œå°‡æœƒï¼š
- å‰µå»º SQLite è³‡æ–™åº«æª”æ¡ˆ
- å»ºç«‹æ‰€éœ€è³‡æ–™è¡¨
- æ’å…¥é è¨­å°‹å¯¶åœ°é»
- å‰µå»ºç®¡ç†å“¡å¸³è™Ÿ (admin/admin123)

### 3. å•Ÿå‹•æœå‹™

```bash
# ç”Ÿç”¢ç’°å¢ƒ
npm start

# é–‹ç™¼ç’°å¢ƒ (ä½¿ç”¨ nodemon)
npm run dev
```

æœå‹™å•Ÿå‹•å¾Œï¼š
- ä¸»æœå‹™: http://localhost:4500
- ç®¡ç†å¾Œå°: http://localhost:4500/admin

## ä½¿ç”¨èªªæ˜

### é¡§å®¢ç«¯ä½¿ç”¨æµç¨‹

1. é¡§å®¢æƒææŒ‡å®šåœ°é»çš„ QR Code
2. åœ¨ç¶²é ä¸­è¼¸å…¥é›»å­éƒµä»¶
3. é»æ“Šã€Œé ˜å–æˆ‘çš„æŠ½çè³‡æ ¼ã€
4. ç³»çµ±ç¢ºèªå¾Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
5. é¡§å®¢æ†‘é›»å­éƒµä»¶è‡³åº—å…§å…Œæ›

### åº—å“¡ç«¯ä½¿ç”¨æµç¨‹

1. è¨ªå• `/admin` é€²å…¥ç®¡ç†å¾Œå°
2. ä½¿ç”¨é è¨­å¸³è™Ÿå¯†ç¢¼ç™»å…¥ (admin/admin123)
3. è¼¸å…¥é¡§å®¢æ‰‹æ©Ÿè™Ÿç¢¼æŸ¥è©¢è³‡æ ¼
4. ç¢ºèªå¾Œé»æ“Šã€Œæ ¸éŠ·ã€å®Œæˆå…Œæ›

### QR Code ç¶²å€æ ¼å¼

æ¯å€‹å°‹å¯¶åœ°é»çš„ QR Code æ‡‰åŒ…å«å°æ‡‰çš„åœ°é»åƒæ•¸ï¼š

```
http://your-domain.com/?spot_id=location_A
http://your-domain.com/?spot_id=location_B
http://your-domain.com/?spot_id=location_C
http://your-domain.com/?spot_id=location_D
http://your-domain.com/?spot_id=location_E
```

## é è¨­è³‡æ–™

### å°‹å¯¶åœ°é»

| spot_id | åœ°é»åç¨± |
|---------|----------|
| location_A | ç¥ç§˜åœ°é» A |
| location_B | ç¥ç§˜åœ°é» B |
| location_C | ç¥ç§˜åœ°é» C |
| location_D | ç¥ç§˜åœ°é» D |
| location_E | ç¥ç§˜åœ°é» E |

### ç®¡ç†å“¡å¸³è™Ÿ

- ä½¿ç”¨è€…åç¨±: `admin`
- å¯†ç¢¼: `admin123`

> âš ï¸ **å®‰å…¨æé†’**: éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒå‰ï¼Œè«‹å‹™å¿…ä¿®æ”¹é è¨­ç®¡ç†å“¡å¯†ç¢¼ï¼

## API æ¥å£

### é¡§å®¢ç«¯ API

#### POST /api/claim-ticket
é ˜å–æŠ½çè³‡æ ¼

**è«‹æ±‚é«”:**
```json
{
  "spot_id": "location_A",
  "phone_number": "0912345678"
}
```

### ç®¡ç†ç«¯ API

#### POST /api/admin/login
ç®¡ç†å“¡ç™»å…¥

#### GET /api/admin/tickets/:phone_number
æŸ¥è©¢é¡§å®¢æŠ½çè³‡æ ¼

#### PUT /api/admin/redeem/:ticket_id
æ ¸éŠ·æŠ½çè³‡æ ¼

## è³‡æ–™åº«çµæ§‹

### lottery_tickets (æŠ½çåˆ¸)
- `id`: ä¸»éµ
- `serial_number`: ç³»çµ±åºè™Ÿ
- `user_id`: é¡§å®¢æ‰‹æ©Ÿè™Ÿç¢¼
- `spot_id`: å°‹å¯¶åœ°é»ID
- `status`: ç‹€æ…‹ (issued/redeemed)
- `created_at`: é ˜å–æ™‚é–“
- `redeemed_at`: æ ¸éŠ·æ™‚é–“

### spots (åœ°é»é…ç½®)
- `id`: åœ°é»ID
- `name`: åœ°é»åç¨±
- `description`: æè¿°
- `is_active`: æ˜¯å¦å•Ÿç”¨

### admin_users (ç®¡ç†å“¡)
- `id`: ä¸»éµ
- `username`: ä½¿ç”¨è€…åç¨±
- `password_hash`: å¯†ç¢¼é›œæ¹Š
- `created_at`: å‰µå»ºæ™‚é–“

## éƒ¨ç½²å»ºè­°

### ç”Ÿç”¢ç’°å¢ƒè¨­å®š

1. **ç’°å¢ƒè®Šæ•¸é…ç½®**
   ```bash
   export PORT=4500
   export NODE_ENV=production
   ```

2. **ä½¿ç”¨ PM2 é€²ç¨‹ç®¡ç†**
   ```bash
   npm install -g pm2
   pm2 start server/app.js --name "qrcode-treasure-hunt"
   pm2 save
   pm2 startup
   ```

3. **Nginx åå‘ä»£ç†**
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;

       location / {
           proxy_pass http://localhost:4500;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```

### å®‰å…¨è€ƒé‡

- å®šæœŸå‚™ä»½ SQLite è³‡æ–™åº«æª”æ¡ˆ
- ä¿®æ”¹é è¨­ç®¡ç†å“¡å¯†ç¢¼
- è€ƒæ…®ä½¿ç”¨ HTTPS
- è¨­ç½®é©ç•¶çš„é˜²ç«ç‰†è¦å‰‡
- å®šæœŸæ›´æ–°ä¾è³´å¥—ä»¶

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **è³‡æ–™åº«æª”æ¡ˆæ¬Šé™éŒ¯èª¤**
   ```bash
   chmod 664 server/database.sqlite
   ```

2. **åŸ è™Ÿè¢«å ç”¨**
   ```bash
   lsof -ti:4500 | xargs kill -9
   ```

3. **æ¸…é™¤è³‡æ–™åº«é‡æ–°åˆå§‹åŒ–**
   ```bash
   rm server/database.sqlite
   npm run init-db
   ```

## æŠ€è¡“æ¶æ§‹

- **å¾Œç«¯**: Node.js + Express
- **è³‡æ–™åº«**: SQLite
- **å‰ç«¯**: åŸç”Ÿ HTML/CSS/JavaScript
- **èªè­‰**: Express Session
- **åŠ å¯†**: bcrypt

## é–‹ç™¼åœ˜éšŠ

æ­¤ç³»çµ±æ ¹æ“š claude.md éœ€æ±‚æ–‡ä»¶é–‹ç™¼ï¼Œé©ç”¨æ–¼å°å‹é›¶å”®åº—é¢çš„è¡ŒéŠ·æ´»å‹•ã€‚

## æˆæ¬Šæ¢æ¬¾

æœ¬å°ˆæ¡ˆåƒ…ä¾›å…§éƒ¨ä½¿ç”¨ï¼Œæœªé–‹æ”¾å¤–éƒ¨æˆæ¬Šã€‚# stoner-qr
